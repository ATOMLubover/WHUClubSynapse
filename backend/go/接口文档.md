# Go 部分后端接口文档

## *Auth Server* 接口

鉴权方式：在 Header 携带 `Authorization: Bearer <JWT>`

### 1. 查询用户信息  

**GET** `/auth/user/:id`  

*功能*：根据用户 ID 获取信息

> 后期可能会修改权限，不暴露给游客用户；也可能会修改响应体格式，仅返回非敏感信息

- **路径参数**：  

  | 字段名 | 类型 | 必填 | 说明    |
  | ------ | ---- | ---- | ------- |
  | `:id`  | int  | 是   | 用户 ID |

- **成功响应 (200, JSON)**：  

  ```json
  {
    "id": 2233,
    "username": "test_user",
    "email": "user@example.com",
    "avatar_url": "https://...",
    "role": "user",
    "last_active": "2025-06-25 15:04:05"
  }
  ```

- **错误场景**：  

  - `400`：ID 格式无效  
  - `404`：用户不存在  

---

### 2. 管理员获取用户列表  

**GET** `/auth/users`  

*功能*：分页查询用户列表（仅限 `admin` 角色） 

- **Query 参数**：  

  | 字段名   | 类型 | 必填 | 说明         |
  | -------- | ---- | ---- | ------------ |
  | `offset` | int  | 是   | 分页起始位置 |
  | `num`    | int  | 是   | 每页数量     |

- **成功响应 (200, JSON)**：  

  ```json
  [
    { "id": 1, "username": "admin", ... },
    { "id": 2, "username": "user1", ... }
  ]
  ```

- **错误场景**：  

  - `400`：分页参数无效 
  - `401`：JWT 无效
  - `403`：非管理员申请  

### 3. 用户活跃状态刷新  

**GET** `/api/v1/auth/ping`  

*功能*：检测后端状态，并更新用户最后活跃时间

- **成功响应（200, TEXT）**：  

  - `200`：返回文本 `"pong"`  

- **错误场景**：

  - `400`：用户状态更新失败  
  - `401`：JWT 无效   

### 4. 用户登录

**POST** `/api/v1/auth/login`  

*功能*：验证用户凭证并返回身份信息

- **请求参数 (JSON)**：  

  | 字段名     | 类型   | 必填 | 说明   |
  | ---------- | ------ | ---- | ------ |
  | `username` | string | 是   | 用户名 |
  | `password` | string | 是   | 密码   |

- **成功响应 (200, JSON)**：  

  ```json
  {
    "id": 2233,
    "username": "test_user",
    "email": "user@example.com",
    "avatar_url": "https://...",
    "role": "user",
    "last_active": "2025-06-25 15:04:05"
  }
  ```

  **Header**：返回 `Authorization: Bearer <JWT>`  

- **错误场景**：  

  - `400`：请求格式错误  
  - `400`：用户名或密码错误  
  - `500`：JWT 生成失败  

### 5. 发送邮箱验证码  

**POST** `/api/v1/auth/verify`  

*功能*：向指定邮箱发送注册验证码（有效期 3 分钟）

- **请求参数 (JSON)**：  

  | 字段名  | 类型   | 必填 | 说明     |
  | ------- | ------ | ---- | -------- |
  | `email` | string | 是   | 邮箱地址 |

- **成功响应（200，TEXT）**：  

  ```text
  邮件已发送至{email}
  ```
- **错误场景**：

  - `202`：验证码已存在
  - `400`：请求格式错误
  - `503`：邮件服务不可用


### 6. 用户注册  

**POST** `/api/v1/auth/register`  

*功能*：使用邮箱验证码创建新用户

- **请求参数 (JSON)**：  

  | 字段名     | 类型   | 必填 | 说明                  |
  | ---------- | ------ | ---- | --------------------- |
  | `username` | string | 是   | 用户名                |
  | `email`    | string | 是   | 邮箱地址              |
  | `password` | string | 是   | **前端加密后的密码**  |
  | `vrf_code` | string | 是   | 邮箱收到的 4 位验证码 |

- **成功响应 (200, JSON)**：  

  ```json
  { "id": 2, "username": "new_user" }
  ```

- **错误场景**：  

  - `400`：请求格式错误、密码无法加密或用户名/邮箱已存在
  - `401`：验证码错误或失效

## TODO

- [] 在数据库中根据发布人、类别等模糊搜索

