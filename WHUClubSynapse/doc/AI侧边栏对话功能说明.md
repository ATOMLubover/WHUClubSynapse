# AI侧边栏对话功能说明

## 功能概述

AI侧边栏对话功能为用户提供了支持多轮、有上下文记忆的连续对话服务。通过RAG（检索增强生成）技术，结合历史对话记录和当前问题的检索结果，生成更具相关性和连贯性的回答，为用户提供智能化的交互体验。

## 功能特点

### 1. 多轮对话
- **上下文记忆**：AI能够记住对话历史，提供连贯的回答
- **智能理解**：根据历史对话理解用户意图，提供更精准的回答
- **连续交互**：支持连续多轮对话，无需重复说明背景

### 2. 知识检索
- **RAG技术**：基于检索增强生成，确保回答的准确性
- **来源标注**：显示回答的参考来源和页码信息
- **实时检索**：每次回答都基于最新的知识库检索

### 3. 用户体验
- **悬浮球设计**：右下角悬浮球，不占用页面空间
- **一键开启**：点击悬浮球即可开始对话
- **响应式设计**：适配不同屏幕尺寸，移动端友好

## 技术实现

### 1. 配置文件

#### ai-search.ts 扩展配置
```typescript
export const aiSearchConfig = {
  // ... 现有配置
  endpoints: {
    smartSearch: '/smart-search',
    sideChat: '/sider-chat',  // 新增侧边栏对话端点
  },
  features: {
    enabled: true,
    showInSearch: true,
    sideChat: true,  // 新增侧边栏对话开关
  },
  sideChat: {
    maxHistory: 10,     // 最大历史记录数
    autoScroll: true,   // 自动滚动到最新消息
    showSource: true,   // 是否显示来源信息
  }
}
```

### 2. 数据结构

#### 对话消息类型
```typescript
interface ChatMessage {
  role: 'user' | 'assistant'
  content: string
  timestamp?: string
}

interface SideChatRequest {
  query: string
  history: ChatMessage[]
}

interface SideChatResponse {
  answer: string
  source: SmartSearchSource[]
}
```

### 3. API接口

#### 侧边栏对话接口
```typescript
// POST /sider-chat
export const sideChat = async (request: SideChatRequest): Promise<SideChatResponse>
```

#### 请求头要求
```
Content-Type: application/json
X-API-Key: YOUR_API_KEY
```

### 4. 前端组件

#### AISideChat.vue 组件
- **悬浮球**：固定位置的圆形按钮
- **对话窗口**：可展开的对话界面
- **消息列表**：显示对话历史
- **输入区域**：支持多行文本输入

## 使用流程

### 1. 开启对话
1. 在页面右下角找到AI悬浮球
2. 点击悬浮球打开对话窗口
3. 查看欢迎消息和问题建议

### 2. 开始对话
1. 在输入框中输入问题
2. 按Enter键或点击发送按钮
3. 等待AI生成回答
4. 查看回答内容和参考来源

### 3. 多轮对话
1. 基于AI的回答继续提问
2. AI会根据历史对话提供更精准的回答
3. 可以随时清空对话历史重新开始

### 4. 关闭对话
1. 点击对话窗口右上角的关闭按钮
2. 或点击悬浮球关闭对话窗口
3. 对话历史会暂时保存

## 界面设计

### 1. 悬浮球设计
- **圆形按钮**：60px直径的圆形悬浮球
- **渐变背景**：蓝色渐变，突出显示
- **悬停效果**：鼠标悬停时放大和阴影变化
- **状态指示**：对话开启时颜色变化

### 2. 对话窗口
- **固定位置**：右下角固定位置
- **圆角设计**：16px圆角，现代化外观
- **分层结构**：头部、内容、输入区域分层
- **阴影效果**：立体感阴影，层次分明

### 3. 消息显示
- **用户消息**：右侧显示，蓝色背景
- **AI消息**：左侧显示，白色背景
- **时间戳**：显示消息发送时间
- **来源信息**：AI回答的参考来源

### 4. 输入区域
- **多行输入**：支持多行文本输入
- **快捷键**：Enter发送，Ctrl+Enter换行
- **发送按钮**：圆形发送按钮
- **输入提示**：显示操作提示信息

## 智能对话特性

### 1. 上下文理解
- **历史记忆**：记住之前的对话内容
- **意图识别**：理解用户的真实意图
- **连贯回答**：基于上下文提供连贯回答

### 2. 个性化回答
- **场景适应**：根据对话场景调整回答风格
- **深度理解**：理解用户的具体需求
- **建议提供**：主动提供相关建议

### 3. 知识整合
- **多源检索**：从多个知识源检索信息
- **信息整合**：整合相关信息形成完整回答
- **准确性保证**：基于真实文档确保准确性

## 配置说明

### 1. 功能开关
```typescript
features: {
  sideChat: true,  // 是否启用侧边栏对话
}
```

### 2. 对话配置
```typescript
sideChat: {
  maxHistory: 10,     // 最大历史记录数
  autoScroll: true,   // 自动滚动
  showSource: true,   // 显示来源
}
```

### 3. API配置
```typescript
endpoints: {
  sideChat: '/sider-chat',  // API端点
}
```

## 错误处理

### 1. 网络错误
- **超时处理**：30秒请求超时
- **重试机制**：失败时自动重试
- **用户提示**：友好的错误信息

### 2. 功能降级
- **功能禁用**：AI不可用时自动禁用
- **用户通知**：告知用户当前状态
- **优雅降级**：不影响其他功能使用

### 3. 输入验证
- **内容检查**：验证输入内容有效性
- **长度限制**：限制输入长度
- **格式检查**：检查输入格式

## 性能优化

### 1. 对话管理
- **历史限制**：限制历史记录数量
- **内存优化**：及时清理无用数据
- **滚动优化**：平滑滚动到最新消息

### 2. 请求优化
- **防抖处理**：避免频繁请求
- **缓存机制**：缓存相同查询结果
- **并发控制**：限制同时请求数量

### 3. 渲染优化
- **虚拟滚动**：大量消息时的性能优化
- **懒加载**：按需加载消息内容
- **动画优化**：流畅的过渡动画

## 安全考虑

### 1. 数据安全
- **内容过滤**：过滤敏感信息
- **隐私保护**：不记录用户个人信息
- **传输加密**：使用HTTPS传输

### 2. 访问控制
- **API Key验证**：验证API访问权限
- **频率限制**：限制请求频率
- **异常检测**：检测异常访问行为

### 3. 内容安全
- **内容审核**：审核AI生成的内容
- **有害信息过滤**：过滤有害信息
- **合规性检查**：确保内容合规

## 扩展功能

### 1. 高级对话
- **语音输入**：支持语音转文字
- **图片识别**：支持图片内容识别
- **多模态交互**：支持多种交互方式

### 2. 个性化功能
- **用户偏好**：记住用户偏好设置
- **对话风格**：根据用户调整对话风格
- **智能推荐**：基于历史推荐相关内容

### 3. 协作功能
- **对话分享**：分享对话内容
- **多人对话**：支持多人同时对话
- **对话导出**：导出对话记录

## 测试建议

### 1. 功能测试
- **基本对话**：测试基本对话功能
- **多轮对话**：测试上下文记忆功能
- **错误处理**：测试各种错误情况

### 2. 性能测试
- **响应时间**：测试对话响应速度
- **并发测试**：测试多用户同时使用
- **压力测试**：测试高负载情况

### 3. 兼容性测试
- **浏览器兼容**：测试不同浏览器
- **设备兼容**：测试不同设备
- **网络环境**：测试不同网络条件

## 部署说明

### 1. 环境准备
1. 确保AI服务正常运行
2. 配置正确的API地址和Key
3. 测试API连接性

### 2. 前端部署
1. 更新配置文件
2. 构建生产版本
3. 部署到服务器

### 3. 监控配置
1. 设置API监控
2. 配置错误告警
3. 监控使用统计

## 注意事项

1. **API Key安全**：妥善保管API Key，不要暴露在代码中
2. **服务可用性**：确保AI服务的稳定性和可用性
3. **用户体验**：保持界面简洁，避免过度复杂
4. **性能优化**：注意响应时间，提供良好的用户体验
5. **错误处理**：完善的错误处理机制，避免影响正常使用
6. **隐私保护**：注意用户隐私保护，不记录敏感信息

---

该功能为用户提供了智能化的对话体验，通过多轮对话和上下文记忆，帮助用户更好地了解社团相关信息，提升了系统的智能化水平和用户交互体验。 